From 569ac1066cd3046b8ac899153df9f07908d45145 Mon Sep 17 00:00:00 2001
From: Mark Asselstine <mark.asselstine@windriver.com>
Date: Fri, 21 Jun 2013 11:16:00 -0400
Subject: [PATCH] openvswitch: add target perl handling

Allow the build to specify a path for the perl instead of reusing
the PERL variable which can lead to inconsistencies if we are cross
compiling. The TARGET_PERL variable will be used for script
substitutions to ensure the scripts will be able to properly execute
if the target system has a different path for the perl.

Signed-off-by: Mark Asselstine <mark.asselstine@windriver.com>
---
 Makefile.am                  | 1 +
 configure.ac                 | 7 +++++++
 utilities/ovs-parse-leaks.in | 2 +-
 3 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/Makefile.am b/Makefile.am
index c4f8341..45488f2 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -111,6 +111,7 @@ SUFFIXES += .in
                 -e 's,[@]LOGDIR[@],$(LOGDIR),g' \
                 -e 's,[@]DBDIR[@],$(DBDIR),g' \
                 -e 's,[@]PERL[@],$(PERL),g' \
+                -e 's,[@]TARGET_PERL[@],$(TARGET_PERL),g' \
                 -e 's,[@]PYTHON[@],$(PYTHON),g' \
                 -e 's,[@]TARGET_PYTHON[@],$(TARGET_PYTHON),g' \
                 -e 's,[@]RUNDIR[@],$(RUNDIR),g' \
diff --git a/configure.ac b/configure.ac
index 74cb691..5e39893 100644
--- a/configure.ac
+++ b/configure.ac
@@ -101,6 +101,13 @@ AC_ARG_VAR(KARCH, [Kernel Architecture String])
 AC_SUBST(KARCH)
 OVS_CHECK_LINUX
 
+if test "$TARGET_PERL"; then
+    TARGET_PERL=$TARGET_PERL
+else
+    TARGET_PERL=$PERL
+fi
+AC_SUBST(TARGET_PERL)
+
 if test "$TARGET_PYTHON"; then
     TARGET_PYTHON=$TARGET_PYTHON
 else
diff --git a/utilities/ovs-parse-leaks.in b/utilities/ovs-parse-leaks.in
index 72417e5..7c9436c 100755
--- a/utilities/ovs-parse-leaks.in
+++ b/utilities/ovs-parse-leaks.in
@@ -1,4 +1,4 @@
-#! @PERL@
+#! @TARGET_PERL@
 
 # Copyright (c) 2009, 2010 Nicira, Inc.
 #
-- 
1.8.1.2

